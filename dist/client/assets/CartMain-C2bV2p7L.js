import{j as t}from"./jsx-runtime-BDjnDDSQ.js";import{J as o,n as v}from"./index-D0HKkxzK.js";import{e as A,r as j,L as C,f as I}from"./chunk-TMI4QPZX-Cy_U8x-I.js";import{u as y,P as N}from"./ProductPrice-Dgtrk0hQ.js";import{I as L}from"./Image-7_9SoOiR.js";import{M as b}from"./Money-Cx_CEXQx.js";function U(e,n){const{pathname:s}=A();return j.useMemo(()=>R({handle:e,pathname:s,searchParams:new URLSearchParams,selectedOptions:n}),[e,n,s])}function R({handle:e,pathname:n,searchParams:s,selectedOptions:i}){const a=/(\/[a-zA-Z]{2}-[a-zA-Z]{2}\/)/g.exec(n),d=a&&a.length>0?`${a[0]}products/${e}`:`/products/${e}`;i==null||i.forEach(l=>{s.set(l.name,l.value)});const c=s.toString();return d+(c?"?"+s.toString():"")}function S({layout:e,line:n}){var h;const{id:s,merchandise:i}=n,{product:a,title:r,image:d,selectedOptions:c}=i,l=U(a.handle,c),{close:x}=y();return t.jsxs("li",{className:"cart-line",children:[d&&t.jsx(L,{alt:r,aspectRatio:"1/1",data:d,height:100,loading:"lazy",width:100}),t.jsxs("div",{children:[t.jsx(C,{prefetch:"intent",to:l,onClick:()=>{e==="aside"&&x()},children:t.jsx("p",{children:t.jsx("strong",{children:a.title})})}),t.jsx(N,{price:(h=n==null?void 0:n.cost)==null?void 0:h.totalAmount}),t.jsx("ul",{children:c.map(u=>t.jsx("li",{children:t.jsxs("small",{children:[u.name,": ",u.value]})},u.name))}),t.jsx(k,{line:n})]})]},s)}function k({line:e}){if(!e||typeof(e==null?void 0:e.quantity)>"u")return null;const{id:n,quantity:s,isOptimistic:i}=e,a=Number(Math.max(0,s-1).toFixed(0)),r=Number((s+1).toFixed(0));return t.jsxs("div",{className:"cart-line-quantity",children:[t.jsxs("small",{children:["Quantity: ",s,"   "]}),t.jsx(p,{lines:[{id:n,quantity:a}],children:t.jsx("button",{"aria-label":"Decrease quantity",disabled:s<=1||!!i,name:"decrease-quantity",value:a,children:t.jsx("span",{children:"− "})})})," ",t.jsx(p,{lines:[{id:n,quantity:r}],children:t.jsx("button",{"aria-label":"Increase quantity",name:"increase-quantity",value:r,disabled:!!i,children:t.jsx("span",{children:"+"})})})," ",t.jsx(q,{lineIds:[n],disabled:!!i})]})}function q({lineIds:e,disabled:n}){return t.jsx(o,{fetcherKey:g(e),route:"/cart",action:o.ACTIONS.LinesRemove,inputs:{lineIds:e},children:t.jsx("button",{disabled:n,type:"submit",children:"Remove"})})}function p({children:e,lines:n}){const s=n.map(i=>i.id);return t.jsx(o,{fetcherKey:g(s),route:"/cart",action:o.ACTIONS.LinesUpdate,inputs:{lines:n},children:e})}function g(e){return[o.ACTIONS.LinesUpdate,...e].join("-")}function D({cart:e,layout:n}){var i,a,r;const s=n==="page"?"cart-summary-page":"cart-summary-aside";return t.jsxs("div",{"aria-labelledby":"cart-summary",className:s,children:[t.jsx("h4",{children:"Totals"}),t.jsxs("dl",{className:"cart-subtotal",children:[t.jsx("dt",{children:"Subtotal"}),t.jsx("dd",{children:(a=(i=e==null?void 0:e.cost)==null?void 0:i.subtotalAmount)!=null&&a.amount?t.jsx(b,{data:(r=e==null?void 0:e.cost)==null?void 0:r.subtotalAmount}):"-"})]}),t.jsx(F,{discountCodes:e==null?void 0:e.discountCodes}),t.jsx(T,{giftCardCodes:e==null?void 0:e.appliedGiftCards}),t.jsx(G,{checkoutUrl:e==null?void 0:e.checkoutUrl})]})}function G({checkoutUrl:e}){return e?t.jsxs("div",{children:[t.jsx("a",{href:e,target:"_self",children:t.jsx("p",{children:"Continue to Checkout →"})}),t.jsx("br",{})]}):null}function F({discountCodes:e}){var s;const n=((s=e==null?void 0:e.filter(i=>i.applicable))==null?void 0:s.map(({code:i})=>i))||[];return t.jsxs("div",{children:[t.jsx("dl",{hidden:!n.length,children:t.jsxs("div",{children:[t.jsx("dt",{children:"Discount(s)"}),t.jsx(f,{children:t.jsxs("div",{className:"cart-discount",children:[t.jsx("code",{children:n==null?void 0:n.join(", ")})," ",t.jsx("button",{children:"Remove"})]})})]})}),t.jsx(f,{discountCodes:n,children:t.jsxs("div",{children:[t.jsx("input",{type:"text",name:"discountCode",placeholder:"Discount code"})," ",t.jsx("button",{type:"submit",children:"Apply"})]})})]})}function f({discountCodes:e,children:n}){return t.jsx(o,{route:"/cart",action:o.ACTIONS.DiscountCodesUpdate,inputs:{discountCodes:e||[]},children:n})}function T({giftCardCodes:e}){const n=j.useRef([]),s=j.useRef(null),i=I({key:"gift-card-add"});j.useEffect(()=>{i.data&&(s.current.value="")},[i.data]);function a(r){const d=r.replace(/\s/g,"");n.current.includes(d)||n.current.push(d)}return t.jsxs("div",{children:[e&&e.length>0&&t.jsxs("dl",{children:[t.jsx("dt",{children:"Applied Gift Card(s)"}),e.map(r=>t.jsx(Q,{giftCardId:r.id,children:t.jsxs("div",{className:"cart-discount",children:[t.jsxs("code",{children:["***",r.lastCharacters]})," ",t.jsx(b,{data:r.amountUsed})," ",t.jsx("button",{type:"submit",children:"Remove"})]})},r.id))]}),t.jsx(w,{giftCardCodes:n.current,saveAppliedCode:a,fetcherKey:"gift-card-add",children:t.jsxs("div",{children:[t.jsx("input",{type:"text",name:"giftCardCode",placeholder:"Gift card code",ref:s})," ",t.jsx("button",{type:"submit",disabled:i.state!=="idle",children:"Apply"})]})})]})}function w({giftCardCodes:e,saveAppliedCode:n,fetcherKey:s,children:i}){return t.jsx(o,{fetcherKey:s,route:"/cart",action:o.ACTIONS.GiftCardCodesUpdate,inputs:{giftCardCodes:e||[]},children:a=>{var d;const r=(d=a.formData)==null?void 0:d.get("giftCardCode");return r&&n&&n(r),i}})}function Q({giftCardId:e,children:n}){return t.jsx(o,{route:"/cart",action:o.ACTIONS.GiftCardCodesRemove,inputs:{giftCardCodes:[e]},children:n})}function O({layout:e,cart:n}){var c,l,x,h,u;const s=v(n),i=!!((l=(c=s==null?void 0:s.lines)==null?void 0:c.nodes)!=null&&l.length),r=`cart-main ${s&&!!((h=(x=s==null?void 0:s.discountCodes)==null?void 0:x.filter(m=>m.applicable))!=null&&h.length)?"with-discount":""}`,d=s!=null&&s.totalQuantity?s.totalQuantity>0:!1;return t.jsxs("div",{className:r,children:[t.jsx(E,{hidden:i,layout:e}),t.jsxs("div",{className:"cart-details",children:[t.jsx("div",{"aria-labelledby":"cart-lines",children:t.jsx("ul",{children:(((u=s==null?void 0:s.lines)==null?void 0:u.nodes)??[]).map(m=>t.jsx(S,{line:m,layout:e},m.id))})}),d&&t.jsx(D,{cart:s,layout:e})]})]})}function E({hidden:e=!1}){const{close:n}=y();return t.jsxs("div",{hidden:e,children:[t.jsx("br",{}),t.jsx("p",{children:"Looks like you haven’t added anything yet, let’s get you started!"}),t.jsx("br",{}),t.jsx(C,{to:"/collections",onClick:n,prefetch:"viewport",children:"Continue shopping →"})]})}export{O as C};
